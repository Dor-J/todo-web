@if (todo) {
  <section class="flex fixed inset-0 z-50 justify-center items-center p-4">
    <div class="absolute inset-0 backdrop-blur-sm bg-slate-950/60 dark:bg-slate-950/80" (click)="close()" aria-hidden="true"></div>

    <div
      role="dialog"
      aria-modal="true"
      class="overflow-hidden relative z-10 w-full max-w-2xl bg-white rounded-3xl border shadow-2xl border-slate-200 dark:border-slate-800 dark:bg-slate-900 shadow-slate-900/10 dark:shadow-slate-950/50"
    >
      <header class="flex justify-between items-start px-6 py-4 border-b border-slate-100 dark:border-slate-800">
        <div>
          <p class="text-xs font-semibold uppercase tracking-[0.3em] text-slate-400 dark:text-slate-500">Edit todo</p>
          <h3 class="text-2xl font-semibold text-slate-950 dark:text-slate-100">{{ todo.title }}</h3>
          <p class="text-xs text-slate-400 dark:text-slate-500">
            Created {{ todo.createdAt | date: 'mediumDate' }}
            @if (todo.updatedAt) {
              • Updated {{ todo.updatedAt | date: 'short' }}
            }
            @if (todo.completedAt) {
              • Completed {{ todo.completedAt | date: 'short' }}
            }
          </p>
        </div>
        <button
          type="button"
          class="rounded-full border border-slate-200 dark:border-slate-700 px-3 py-1 text-xs font-semibold uppercase tracking-[0.3em] text-slate-500 dark:text-slate-400 transition hover:text-slate-900 dark:hover:text-slate-200 hover:border-slate-300 dark:hover:border-slate-600"
          (click)="close()"
        >
          Close
        </button>
      </header>

      <form class="px-6 py-6 space-y-5" [formGroup]="form" (ngSubmit)="handleSubmit()">
        <div class="flex flex-col gap-2">
          <label class="text-sm font-medium text-slate-600 dark:text-slate-300">Title</label>
          <input
            #titleInput
            type="text"
            formControlName="title"
            [class]="'w-full rounded-2xl border px-4 py-3 text-slate-900 dark:text-slate-100 placeholder:text-slate-400 dark:placeholder:text-slate-500 focus:outline-none focus:ring-2 ' + (form.controls.title.invalid && form.controls.title.touched ? 'border-rose-500 dark:border-rose-400 bg-white dark:bg-slate-800 focus:border-rose-500 dark:focus:border-rose-400 focus:ring-rose-200 dark:focus:ring-rose-900' : 'border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 focus:border-slate-400 dark:focus:border-slate-600 focus:ring-slate-200 dark:focus:ring-slate-700')"
            placeholder="Give this todo a clear action"
          />
          @if (getErrorMessage(form.controls.title, 'Title')) {
            <p class="text-xs font-semibold uppercase tracking-[0.3em] text-rose-500 dark:text-rose-400">
              {{ getErrorMessage(form.controls.title, 'Title') }}
            </p>
          }
        </div>

        <div class="flex flex-col gap-2">
          <label class="text-sm font-medium text-slate-600 dark:text-slate-300">Description</label>
          <textarea
            rows="4"
            formControlName="description"
            [class]="'w-full rounded-2xl border px-4 py-3 text-slate-900 dark:text-slate-100 placeholder:text-slate-400 dark:placeholder:text-slate-500 focus:outline-none focus:ring-2 ' + (form.controls.description.invalid && form.controls.description.touched ? 'border-rose-500 dark:border-rose-400 bg-white dark:bg-slate-800 focus:border-rose-500 dark:focus:border-rose-400 focus:ring-rose-200 dark:focus:ring-rose-900' : 'border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 focus:border-slate-400 dark:focus:border-slate-600 focus:ring-slate-200 dark:focus:ring-slate-700')"
            placeholder="Add context, links, or acceptance criteria."
          ></textarea>
          @if (getErrorMessage(form.controls.description, 'Description')) {
            <p class="text-xs font-semibold uppercase tracking-[0.3em] text-rose-500 dark:text-rose-400">
              {{ getErrorMessage(form.controls.description, 'Description') }}
            </p>
          }
        </div>

        <div class="flex flex-col gap-2">
          <label class="text-sm font-medium text-slate-600 dark:text-slate-300">Priority</label>
          <select
            formControlName="priority"
            [class]="'w-full rounded-2xl border px-4 py-3 text-slate-900 dark:text-slate-100 focus:outline-none focus:ring-2 border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 focus:border-slate-400 dark:focus:border-slate-600 focus:ring-slate-200 dark:focus:ring-slate-700'"
          >
            <option value="LOW">Low</option>
            <option value="MEDIUM">Medium</option>
            <option value="HIGH">High</option>
          </select>
        </div>

        <div class="flex flex-col gap-3">
          <label class="inline-flex gap-3 items-center px-4 py-3 text-sm rounded-2xl border border-slate-100 dark:border-slate-800 bg-slate-50 dark:bg-slate-800/50 text-slate-600 dark:text-slate-300">
            <input
              type="checkbox"
              formControlName="isCompleted"
              class="w-4 h-4 rounded border-slate-300 dark:border-slate-600 text-slate-900 dark:text-slate-100 focus:ring-slate-400 dark:focus:ring-slate-600"
            />
            Mark as completed
          </label>

          <label class="inline-flex gap-3 items-center px-4 py-3 text-sm rounded-2xl border border-slate-100 dark:border-slate-800 bg-slate-50 dark:bg-slate-800/50 text-slate-600 dark:text-slate-300">
            <input
              type="checkbox"
              formControlName="starred"
              class="w-4 h-4 rounded border-slate-300 dark:border-slate-600 text-slate-900 dark:text-slate-100 focus:ring-slate-400 dark:focus:ring-slate-600"
            />
            Starred
          </label>
        </div>

        <div class="flex flex-wrap  justify-center md:justify-end gap-3 pt-2 text-xs font-semibold uppercase tracking-[0.3em]">
          <button
            type="submit"
            class="px-8 py-2 text-white rounded-full shadow transition bg-slate-900 dark:bg-slate-700 shadow-slate-900/20 dark:shadow-slate-950/30 hover:bg-slate-800 dark:hover:bg-slate-600"
          >
            Save changes
          </button>
          <button
            type="button"
            class="px-6 py-2 rounded-full border transition border-slate-200 dark:border-slate-700 text-slate-500 dark:text-slate-400 hover:text-slate-900 dark:hover:text-slate-200 hover:border-slate-300 dark:hover:border-slate-600"
            (click)="close()"
          >
            Cancel
          </button>
        </div>
      </form>
    </div>
  </section>
}
